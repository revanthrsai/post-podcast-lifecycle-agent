<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Outputs Dashboard (Pretty View v4)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden
    }

    :root {
      --bg: #f5f5f5;
      --text: #222;
      --card: #fff;
      --border: #ddd;
      --muted: #666;
      --tag-bg: #e0eaff;
      --tag-text: #1744c7;
    }

    body.dark {
      --bg: #121212;
      --text: #e5e5e5;
      --card: #1e1e1e;
      --border: #333;
      --muted: #aaa;
      --tag-bg: #2a3b5a;
      --tag-text: #aecdff;
    }

    .layout {
      display: flex;
      height: 100vh
    }

    .sidebar {
      width: 280px;
      background: var(--card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid var(--border)
    }

    .sidebar-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px
    }

    .sidebar-subtitle {
      font-size: 12px;
      color: var(--muted)
    }

    .file-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0
    }

    .file-item {
      padding: 10px 24px;
      cursor: pointer;
      font-size: 14px;
      color: var(--text)
    }

    .file-item:hover {
      background: #eaeaea
    }

    body.dark .file-item:hover {
      background: #1f1f1f
    }

    .file-item.active {
      background: #dbe7ff;
      color: #1a56db;
      font-weight: 600
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden
    }

    .content-header {
      padding: 20px 32px;
      border-bottom: 1px solid var(--border);
      background: var(--card);
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .header-titles {
      display: flex;
      flex-direction: column
    }

    .content-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--text)
    }

    .content-subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px
    }

    .header-buttons {
      display: flex;
      gap: 12px;
      align-items: center
    }

    .btn {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px
    }

    .btn-copy {
      background: #3b82f6;
      color: white
    }

    .btn-copy:hover {
      background: #2563eb
    }

    .btn-download {
      background: #eee;
      color: #222
    }

    .btn-download:hover {
      background: #ddd
    }

    .dark-btn {
      cursor: pointer;
      font-size: 20px;
      padding: 6px;
      border-radius: 6px
    }

    .dark-btn:hover {
      background: #eaeaea
    }

    body.dark .dark-btn:hover {
      background: #2a2a2a
    }

    .content-body {
      padding: 28px;
      overflow: auto
    }

    .pretty-view {
      background: var(--card);
      border: 1px solid var(--border);
      padding: 24px;
      border-radius: 12px;
      max-width: 900px;
      margin: 0 auto;
      font-size: 15px;
      color: var(--text);
      line-height: 1.55
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px
    }

    td,
    th {
      border: 1px solid var(--border);
      padding: 8px
    }

    th {
      background: #f0f0f0
    }

    body.dark th {
      background: #1f1f1f
    }

    ul {
      margin: 10px 0 20px 24px
    }

    .block-text {
      white-space: pre-line;
      margin: 8px 0 16px 0
    }

    .kw {
      display: inline-block;
      background: var(--tag-bg);
      color: var(--tag-text);
      padding: 4px 8px;
      border-radius: 6px;
      margin: 4px;
      font-size: 13px
    }

    .toast {
      position: fixed;
      bottom: 28px;
      right: 28px;
      background: #333;
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s ease;
    }

    body.dark .toast {
      background: #eee;
      color: #111
    }
  </style>
</head>

<body>

  <div class="layout">

    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">Post Podcast Files</div>
        <div class="sidebar-subtitle">Auto-generated</div>
      </div>
      <div id="file-list" class="file-list"></div>
    </div>

    <div class="main-content">
      <div class="content-header">
        <div class="header-titles">
          <div class="content-title" id="content-title">Select a file</div>
        </div>

        <div class="header-buttons">
          <button class="btn btn-copy" id="btn-copy">Copy JSON</button>
          <button class="btn btn-download" id="btn-download">Download</button>
          <div class="dark-btn" id="darkToggle">üåô</div>
        </div>
      </div>

      <div class="content-body">
        <div id="pretty-view" class="pretty-view" style="display:none;">Loading‚Ä¶</div>
      </div>
    </div>

  </div>

  <div id="toast" class="toast">Copied!</div>

  <script>
    let currentFile = null, currentData = null;

    async function loadFileList() {
      const res = await fetch('/api/list');
      const j = await res.json();
      const list = document.getElementById('file-list');
      list.innerHTML = '';
      j.files.forEach(f => {
        const d = document.createElement('div');
        d.className = 'file-item';
        d.textContent = f;
        d.onclick = () => selectFile(f, d);
        list.appendChild(d);
      });
    }

    async function selectFile(filename, node) {
      document.querySelectorAll('.file-item').forEach(x => x.classList.remove('active'));
      node.classList.add('active');

      currentFile = filename;
      document.getElementById('content-title').textContent = filename;

      const pv = document.getElementById('pretty-view');
      pv.style.display = 'block';
      pv.innerHTML = "Loading‚Ä¶";

      const res = await fetch('/api/json/' + filename);
      currentData = await res.json();

      pv.innerHTML = renderPretty(currentData, filename);
    }

    function renderPretty(data, filename) {
      filename = filename.toLowerCase();
      if (filename.includes("timestamp")) return renderChapters(data);
      if (filename.includes("outline")) return renderOutline(data);
      if (filename.includes("quotes")) return renderQuotes(data);
      if (filename.includes("seo")) return renderSEO(data);
      if (filename.includes("show_notes")) return renderShowNotes(data);
      if (filename.includes("research")) return renderResearch(data);
      if (filename.includes("social")) return renderSocial(data);
      if (filename.includes("transcription")) return renderTranscription(data);
      if (filename.includes("transcript")) return renderTranscription(data);
      return "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
    }

    function renderChapters(d) {
      if (!d.chapters) return "Invalid structure";
      let html = "<table><tr><th>Start</th><th>Title</th></tr>";
      d.chapters.forEach(c => html += `<tr><td>${c.start}</td><td>${c.title}</td></tr>`);
      return html + "</table>";
    }

    function renderOutline(d) {
      let html = "";
      if (d.hook) html += `<p><b>Hook:</b><br><div class='block-text'>${d.hook}</div></p>`;
      if (d.closing) html += `<p><b>Closing:</b><br><div class='block-text'>${d.closing}</div></p>`;
      if (d.segments) {
        d.segments.forEach(seg => {
          html += `<h3>${seg.title}</h3>`;
          if (seg.summary) html += `<div class='block-text'>${seg.summary}</div>`;
          if (seg.bullets) {
            html += "<ul>";
            seg.bullets.forEach(b => html += `<li>${b}</li>`);
            html += "</ul>";
          }
        });
      }
      return html;
    }

    function renderQuotes(d) {
      if (!d.quotes) return "Invalid structure";
      return d.quotes.map(q => `<p style='padding:10px 0;border-bottom:1px solid var(--border)'>‚ùù ${q} ‚ùû</p>`).join("");
    }

    function renderSEO(d) {
      let html = "";
      if (d.title) html += `<h3>${d.title}</h3>`;
      if (d.meta_description) html += `<p class='block-text'>${d.meta_description}</p>`;
      if (d.keywords) {
        html += "<p>";
        d.keywords.forEach(k => html += `<span class='kw'>${k}</span>`);
        html += "</p>";
      }
      return html;
    }

    function renderShowNotes(d) {
      let html = "";
      if (d.summary) html += `<div class='block-text'>${d.summary}</div>`;
      if (d.bullets) {
        html += "<ul>";
        d.bullets.forEach(b => html += `<li>${b}</li>`);
        html += "</ul>";
      }
      return html;
    }

    function renderResearch(d) {
      let html = "";
      if (d.summary) html += `<div class='block-text'>${d.summary}</div>`;
      if (d.bullets) {
        html += "<ul>";
        d.bullets.forEach(b => html += `<li>${b}</li>`);
        html += "</ul>";
      }
      return html;
    }

    function renderSocial(d) {
      let html = "";
      Object.keys(d).forEach(key => {
        if (Array.isArray(d[key])) {
          html += `<p><b>${key}:</b></p><p>`;
          d[key].forEach(t => html += `<span class='kw'>${t}</span>`);
          html += "</p>";
        } else {
          html += `<p><b>${key}:</b><br><div class='block-text'>${d[key]}</div></p>`;
        }
      });
      return html;
    }

    function renderTranscription(d) {
      const text = d.transcript || d.transcription;
      if (text)
        return `<div class='block-text'>${text}</div>`;
      return `<pre>${JSON.stringify(d, null, 2)}</pre>`;
    }

    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.style.opacity = 1;
      setTimeout(() => t.style.opacity = 0, 1500);
    }

    document.getElementById("btn-copy").onclick = () => {
      if (currentData)
        navigator.clipboard.writeText(JSON.stringify(currentData, null, 2))
          .then(() => showToast("Copied!"));
    };
    document.getElementById("btn-download").onclick = () => {
      if (currentFile) window.location.href = "/download/" + currentFile;
    };


    const darkToggle = document.getElementById("darkToggle");
    function setDark(mode) {
      document.body.classList.toggle("dark", mode);
      localStorage.setItem("pretty_dark", mode ? "1" : "0");
      darkToggle.textContent = mode ? "‚òÄÔ∏è" : "üåô";
    }
    darkToggle.onclick = () => setDark(!document.body.classList.contains("dark"));
    setDark(localStorage.getItem("pretty_dark") === "1");

    /*init */
    loadFileList();
  </script>
</body>

</html>